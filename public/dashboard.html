<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1>Dashboard</h1>
            <div>
                <span id="welcomeMsg" style="margin-right: 15px; color: var(--text-muted);"></span>
                <a href="/logout"><button class="secondary sm">Logout</button></a>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <h2>ðŸš€ Create Party</h2>
                <form action="/api/create-lobby" method="POST">
                    <input type="text" name="name" placeholder="Party Name (e.g. Chill Vibes)" required>
                    <label style="display: flex; align-items: center; gap: 10px; margin: 15px 0; cursor: pointer;">
                        <input type="checkbox" name="private" style="width: auto;"> 
                        <span>Make Private (Invite Only)</span>
                    </label>
                    <button type="submit">Start Party</button>
                </form>
            </div>

            <div class="card">
                <h2>ðŸŽ‰ Public Parties</h2>
                <div id="lobbyList" style="margin-top: 15px;">
                    <p style="color: var(--text-muted);">Loading parties...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fetch User Info
        fetch('/api/me').then(r => r.json()).then(data => {
            if(!data.user) window.location = '/';
            document.getElementById('welcomeMsg').textContent = `Hello, ${data.user}`;
        });

        // Fetch Lobbies
        function loadLobbies() {
            fetch('/api/lobbies')
                .then(r => r.json())
                .then(lobbies => {
                    const container = document.getElementById('lobbyList');
                    container.innerHTML = '';
                    if(lobbies.length === 0) {
                        container.innerHTML = '<p style="color: var(--text-muted);">No public parties active right now.</p>';
                        return;
                    }
                    lobbies.forEach(l => {
                        const div = document.createElement('div');
                        div.className = 'lobby-list-item';
                        div.innerHTML = `
                            <div>
                                <strong>${l.name}</strong><br>
                                <small style="color:var(--text-muted)">Host: ${l.host}</small>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span style="font-size:0.9rem;">ðŸ‘¥ ${l.count}</span>
                                <a href="/lobby.html?id=${l.id}"><button class="sm">Join</button></a>
                            </div>
                        `;
                        container.appendChild(div);
                    });
                });
        }
        loadLobbies();
        setInterval(loadLobbies, 5000); // Auto refresh every 5s
    </script>
</body>
</html>